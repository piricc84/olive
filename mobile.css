:root{
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
}

body{
  overscroll-behavior-y: contain;
}

@media (max-width: 980px){
  .app{min-height:100dvh;}

  .sidebar{
    width: min(320px, 88vw);
    padding-left: max(16px, calc(12px + var(--safe-left)));
    padding-right: max(16px, calc(12px + var(--safe-right)));
    border-right: none;
    box-shadow: 0 24px 50px rgba(31,42,31,.18);
  }

  .main{
    padding: calc(16px + var(--safe-top)) calc(16px + var(--safe-right)) calc(90px + var(--safe-bottom)) calc(16px + var(--safe-left));
  }

  .topbar{
    position: sticky;
    top: calc(6px + var(--safe-top));
    z-index: 6;
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 16px;
    background: var(--panel);
    border: 1px solid var(--border);
    box-shadow: 0 12px 28px rgba(31,42,31,.16);
  }

  .topbar .left{width:100%}
  .search{width:100%; min-width:0}

  .actions{
    width:100%;
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:8px;
  }
  .actions .btn{width:100%}
  .search input,
  .field input,
  .field select,
  .field textarea,
  .btn{font-size:16px}

  .card{border-radius:14px}
  .toast{width: min(480px, calc(100vw - 28px))}
  .map{height:360px}
}

@media (max-width: 640px){
  .actions{grid-template-columns: 1fr}
  .kpi{grid-column: span 12}
  .toast{
    left: calc(12px + var(--safe-left));
    right: calc(12px + var(--safe-right));
  }
  .table th, .table td{font-size:12px}
  .brand{align-items:flex-start}
  .map{height:300px}
  .outbox-item{flex-direction:column; align-items:flex-start}
  .media-thumb{height:100px}
  .modal{max-height: calc(100dvh - 16px); border-radius:16px}
  .modal-backdrop{padding: calc(8px + var(--safe-top)) 10px calc(8px + var(--safe-bottom)) 10px}
}

@supports (-webkit-touch-callout: none){
  .main{
    padding-bottom: calc(110px + var(--safe-bottom));
  }
}
